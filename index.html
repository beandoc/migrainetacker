<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Migraine & Headache Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .head-diagram {
            width: 200px;
            height: 240px;
            margin: 0 auto;
            position: relative;
            cursor: pointer;
        }
        .pain-area {
            position: absolute;
            border: 2px solid transparent;
            border-radius: 50%;
            transition: all 0.2s;
        }
        .pain-area:hover {
            border-color: #ef4444;
            background-color: rgba(239, 68, 68, 0.1);
        }
        .pain-area.selected {
            border-color: #dc2626;
            background-color: rgba(239, 68, 68, 0.3);
        }
        .slider-track {
            background: linear-gradient(to right, #10b981 0%, #f59e0b 50%, #ef4444 100%);
        }
        .notification-dot {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-4xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <h1 class="text-xl font-bold text-gray-800">🧠 Migraine Tracker</h1>
                <div class="flex space-x-2">
                    <button onclick="showView('dashboard')" class="px-3 py-2 text-sm font-medium text-gray-600 hover:text-indigo-600 transition-colors">Dashboard</button>
                    <button onclick="showView('analytics')" class="px-3 py-2 text-sm font-medium text-gray-600 hover:text-indigo-600 transition-colors">Analytics</button>
                    <button onclick="showView('settings')" class="px-3 py-2 text-sm font-medium text-gray-600 hover:text-indigo-600 transition-colors">Settings</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Dashboard View -->
    <div id="dashboard" class="view max-w-4xl mx-auto p-4">
        <!-- Hero Section -->
        <div class="bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 rounded-2xl p-8 mb-8 text-white relative overflow-hidden">
            <div class="absolute inset-0 bg-black bg-opacity-20"></div>
            <div class="relative z-10">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl md:text-4xl font-bold mb-2">Welcome back! 👋</h1>
                        <p class="text-lg text-indigo-100 mb-4">Take control of your migraines with smart tracking and insights</p>
                        <div class="flex items-center space-x-6 text-sm">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-green-400 rounded-full mr-2"></div>
                                <span>7 days migraine-free</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-yellow-400 rounded-full mr-2"></div>
                                <span>Last entry: 2 days ago</span>
                            </div>
                        </div>
                    </div>
                    <div class="hidden md:block">
                        <div class="w-32 h-32 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                            <span class="text-6xl">🧠</span>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Action Buttons -->
                <div class="flex flex-wrap gap-3 mt-6">
                    <button onclick="startQuickLog()" class="bg-white bg-opacity-20 hover:bg-opacity-30 backdrop-blur-sm text-white font-medium py-2 px-4 rounded-lg transition-all duration-200 flex items-center">
                        <span class="mr-2">⚡</span>
                        Quick Log
                    </button>
                    <button onclick="showView('analytics')" class="bg-white bg-opacity-20 hover:bg-opacity-30 backdrop-blur-sm text-white font-medium py-2 px-4 rounded-lg transition-all duration-200 flex items-center">
                        <span class="mr-2">📊</span>
                        View Analytics
                    </button>
                    <button onclick="generateDoctorReport()" class="bg-white bg-opacity-20 hover:bg-opacity-30 backdrop-blur-sm text-white font-medium py-2 px-4 rounded-lg transition-all duration-200 flex items-center">
                        <span class="mr-2">📋</span>
                        Doctor Report
                    </button>
                </div>
            </div>
            
            <!-- Decorative Elements -->
            <div class="absolute top-4 right-4 w-20 h-20 bg-white bg-opacity-10 rounded-full"></div>
            <div class="absolute bottom-4 left-4 w-16 h-16 bg-white bg-opacity-10 rounded-full"></div>
            <div class="absolute top-1/2 right-1/4 w-8 h-8 bg-white bg-opacity-10 rounded-full"></div>
        </div>

        <!-- Quick Stats -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-100 hover:shadow-xl transition-shadow duration-200">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600 mb-1">This Month</p>
                        <p class="text-3xl font-bold text-gray-800" id="monthlyCount">7</p>
                        <p class="text-xs text-green-600 mt-1 flex items-center">
                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                            </svg>
                            12% less than last month
                        </p>
                    </div>
                    <div class="w-12 h-12 bg-gradient-to-br from-red-500 to-pink-500 rounded-xl flex items-center justify-center">
                        <span class="text-white text-xl">⚡</span>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-100 hover:shadow-xl transition-shadow duration-200">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600 mb-1">Avg Intensity</p>
                        <p class="text-3xl font-bold text-gray-800">6.2</p>
                        <p class="text-xs text-yellow-600 mt-1 flex items-center">
                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"></path>
                            </svg>
                            Moderate severity
                        </p>
                    </div>
                    <div class="w-12 h-12 bg-gradient-to-br from-yellow-500 to-orange-500 rounded-xl flex items-center justify-center">
                        <span class="text-white text-xl">📊</span>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl p-6 shadow-lg border border-gray-100 hover:shadow-xl transition-shadow duration-200">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600 mb-1">Top Trigger</p>
                        <p class="text-2xl font-bold text-gray-800">Stress</p>
                        <p class="text-xs text-red-600 mt-1 flex items-center">
                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                            </svg>
                            80% correlation
                        </p>
                    </div>
                    <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-indigo-500 rounded-xl flex items-center justify-center">
                        <span class="text-white text-xl">🎯</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Log Button -->
        <div class="text-center mb-8">
            <div class="bg-white rounded-2xl p-8 shadow-lg border border-gray-100">
                <div class="mb-4">
                    <div class="w-16 h-16 bg-gradient-to-r from-red-500 to-pink-500 rounded-full flex items-center justify-center mx-auto mb-4">
                        <span class="text-white text-2xl">⚡</span>
                    </div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Having a migraine right now?</h3>
                    <p class="text-gray-600 mb-6">Log the essentials in just 60 seconds, add details when you feel better</p>
                </div>
                <button onclick="startQuickLog()" class="bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white font-bold py-4 px-8 rounded-xl text-lg shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center mx-auto">
                    <span class="mr-2">+</span>
                    Log Headache Now
                </button>
                <div class="flex items-center justify-center mt-4 text-sm text-gray-500">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Takes less than 1 minute
                </div>
            </div>
        </div>

        <!-- Recent Entries -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-100">
            <div class="p-6 border-b border-gray-100">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center mr-3">
                            <span class="text-indigo-600 text-lg">📝</span>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-gray-800">Recent Entries</h2>
                            <p class="text-sm text-gray-500">Your latest migraine logs and patterns</p>
                        </div>
                    </div>
                    <button onclick="showView('analytics')" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium flex items-center">
                        View All
                        <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="divide-y divide-gray-100" id="recentEntries">
                <!-- Recent entries will be populated here -->
            </div>
        </div>
    </div>

    <!-- Quick Log Modal -->
    <div id="quickLogModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl max-w-md w-full p-6">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Quick Log</h2>
                    <p class="text-gray-600">Log the essentials now, add details later</p>
                </div>

                <!-- Step 1: When did it start? -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">When did it start?</label>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <button onclick="setStartTime('now')" class="quick-time-btn bg-indigo-100 text-indigo-700 py-3 px-4 rounded-lg font-medium hover:bg-indigo-200 transition-colors">Now</button>
                        <button onclick="setStartTime('5min')" class="quick-time-btn bg-gray-100 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-200 transition-colors">5 mins ago</button>
                        <button onclick="setStartTime('15min')" class="quick-time-btn bg-gray-100 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-200 transition-colors">15 mins ago</button>
                        <button onclick="setStartTime('30min')" class="quick-time-btn bg-gray-100 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-200 transition-colors">30 mins ago</button>
                    </div>
                    <input type="datetime-local" id="customStartTime" class="w-full p-3 border border-gray-300 rounded-lg">
                </div>

                <!-- Step 2: Pain Intensity -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Pain Intensity</label>
                    <div class="relative">
                        <input type="range" id="painSlider" min="1" max="10" value="5" class="w-full h-3 slider-track rounded-lg appearance-none cursor-pointer">
                        <div class="flex justify-between text-xs text-gray-500 mt-2">
                            <span>1<br>Mild</span>
                            <span>4<br>Moderate</span>
                            <span>7<br>Severe</span>
                            <span>10<br>Worst</span>
                        </div>
                    </div>
                    <div class="text-center mt-3">
                        <span class="text-2xl font-bold text-gray-800" id="painValue">5</span>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex space-x-3">
                    <button onclick="saveForLater()" class="flex-1 bg-gray-200 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-300 transition-colors">Save for Later</button>
                    <button onclick="continueDetailed()" class="flex-1 bg-indigo-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-indigo-700 transition-colors">Add Details</button>
                </div>

                <button onclick="closeQuickLog()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Detailed Log Modal -->
    <div id="detailedLogModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl max-w-2xl w-full p-6 my-8">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Detailed Log</h2>
                    <p class="text-gray-600">Add more information about your headache</p>
                </div>

                <!-- Pain Location -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Pain Location</label>
                    <div class="flex flex-col items-center mb-4">
                        <div class="head-diagram bg-gray-100 rounded-full relative">
                            <!-- Head diagram areas -->
                            <div class="pain-area" data-location="left_side" style="top: 60px; left: 20px; width: 60px; height: 80px;"></div>
                            <div class="pain-area" data-location="right_side" style="top: 60px; right: 20px; width: 60px; height: 80px;"></div>
                            <div class="pain-area" data-location="forehead" style="top: 40px; left: 60px; width: 80px; height: 40px;"></div>
                            <div class="pain-area" data-location="behind_eyes" style="top: 70px; left: 70px; width: 60px; height: 30px;"></div>
                            <div class="pain-area" data-location="base_skull" style="bottom: 20px; left: 70px; width: 60px; height: 40px;"></div>
                        </div>
                        <p class="text-sm text-gray-500 mt-2">Tap on the head diagram to select pain areas</p>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="toggleLocation('left_side')" class="location-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Left Side</button>
                        <button onclick="toggleLocation('right_side')" class="location-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Right Side</button>
                        <button onclick="toggleLocation('both_sides')" class="location-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Both Sides</button>
                        <button onclick="toggleLocation('forehead')" class="location-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Forehead</button>
                    </div>
                </div>

                <!-- Pain Character -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Pain Character (select all that apply)</label>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="toggleCharacter('throbbing')" class="character-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Throbbing</button>
                        <button onclick="toggleCharacter('stabbing')" class="character-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Stabbing</button>
                        <button onclick="toggleCharacter('dull_ache')" class="character-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Dull Ache</button>
                        <button onclick="toggleCharacter('pressure')" class="character-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Pressure</button>
                        <button onclick="toggleCharacter('burning')" class="character-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Burning</button>
                        <button onclick="toggleCharacter('electric')" class="character-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Electric</button>
                    </div>
                </div>

                <!-- Aura -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Aura</label>
                    <div class="flex items-center space-x-4 mb-3">
                        <label class="flex items-center">
                            <input type="radio" name="aura" value="no" checked class="mr-2">
                            <span>No aura</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="aura" value="yes" class="mr-2" onchange="toggleAuraDetails()">
                            <span>Yes, I had an aura</span>
                        </label>
                    </div>
                    <div id="auraDetails" class="hidden">
                        <div class="grid grid-cols-1 gap-2">
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2" value="visual">
                                <span class="text-sm">Visual (flashing lights, zig-zag lines, blind spots)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2" value="sensory">
                                <span class="text-sm">Sensory (tingling, numbness)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="mr-2" value="speech">
                                <span class="text-sm">Speech difficulties</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Associated Symptoms -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Associated Symptoms (select all that apply)</label>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="toggleSymptom('nausea')" class="symptom-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">🤢 Nausea</button>
                        <button onclick="toggleSymptom('vomiting')" class="symptom-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">🤮 Vomiting</button>
                        <button onclick="toggleSymptom('photophobia')" class="symptom-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">💡 Light Sensitivity</button>
                        <button onclick="toggleSymptom('phonophobia')" class="symptom-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">🔊 Sound Sensitivity</button>
                        <button onclick="toggleSymptom('osmophobia')" class="symptom-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">👃 Smell Sensitivity</button>
                        <button onclick="toggleSymptom('dizziness')" class="symptom-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">😵 Dizziness/Vertigo</button>
                        <button onclick="toggleSymptom('neck_pain')" class="symptom-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">🦴 Neck Pain/Stiffness</button>
                        <button onclick="toggleSymptom('brain_fog')" class="symptom-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">🧠 Brain Fog</button>
                    </div>
                </div>

                <!-- Potential Triggers -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Potential Triggers</label>
                    
                    <!-- Diet Triggers -->
                    <div class="mb-4">
                        <button onclick="toggleTriggerCategory('diet')" class="flex items-center justify-between w-full p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <span class="font-medium text-gray-700">🍽️ Diet</span>
                            <svg class="w-5 h-5 text-gray-500 transform transition-transform" id="dietArrow" viewBox="0 0 24 24" fill="none">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div id="dietTriggers" class="hidden mt-2 grid grid-cols-2 gap-2 pl-4">
                            <button onclick="toggleTrigger('caffeine')" class="trigger-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Caffeine</button>
                            <button onclick="toggleTrigger('alcohol')" class="trigger-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Alcohol</button>
                            <button onclick="toggleTrigger('aged_cheese')" class="trigger-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Aged Cheese</button>
                            <button onclick="toggleTrigger('processed_meat')" class="trigger-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Processed Meat</button>
                            <button onclick="toggleTrigger('skipped_meal')" class="trigger-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Skipped Meal</button>
                            <button onclick="toggleTrigger('dehydration')" class="trigger-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Dehydration</button>
                        </div>
                    </div>

                    <!-- Environment Triggers -->
                    <div class="mb-4">
                        <button onclick="toggleTriggerCategory('environment')" class="flex items-center justify-between w-full p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <span class="font-medium text-gray-700">🌍 Environment</span>
                            <svg class="w-5 h-5 text-gray-500 transform transition-transform" id="environmentArrow" viewBox="0 0 24 24" fill="none">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div id="environmentTriggers" class="hidden mt-2 grid grid-cols-2 gap-2 pl-4">
                            <button onclick="toggleTrigger('bright_lights')" class="trigger-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Bright/Flickering Lights</button>
                            <button onclick="toggleTrigger('loud_sounds')" class="trigger-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Loud Noises</button>
                            <button onclick="toggleTrigger('strong_smells')" class="trigger-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Strong Smells</button>
                            <button onclick="toggleTrigger('weather_change')" class="trigger-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Weather Change</button>
                        </div>
                    </div>

                    <!-- Lifestyle Triggers -->
                    <div class="mb-4">
                        <button onclick="toggleTriggerCategory('lifestyle')" class="flex items-center justify-between w-full p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <span class="font-medium text-gray-700">🏃 Lifestyle</span>
                            <svg class="w-5 h-5 text-gray-500 transform transition-transform" id="lifestyleArrow" viewBox="0 0 24 24" fill="none">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div id="lifestyleTriggers" class="hidden mt-2 grid grid-cols-2 gap-2 pl-4">
                            <button onclick="toggleTrigger('lack_sleep')" class="trigger-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Lack of Sleep</button>
                            <button onclick="toggleTrigger('oversleeping')" class="trigger-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Oversleeping</button>
                            <button onclick="toggleTrigger('work_stress')" class="trigger-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Work Stress</button>
                            <button onclick="toggleTrigger('personal_stress')" class="trigger-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Personal Stress</button>
                            <button onclick="toggleTrigger('intense_exercise')" class="trigger-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Intense Exercise</button>
                            <button onclick="toggleTrigger('hormonal')" class="trigger-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">Hormonal Changes</button>
                        </div>
                    </div>

                    <!-- Automatic Context -->
                    <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                        <h4 class="font-medium text-blue-800 mb-2">📊 Automatic Context</h4>
                        <p class="text-sm text-blue-700 mb-3">We noticed these factors in the 24 hours before your migraine. Could they be related?</p>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-blue-700">Sleep last night:</span>
                                <span class="text-sm font-medium text-blue-800">5.2 hours</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-blue-700">Menstrual cycle:</span>
                                <span class="text-sm font-medium text-blue-800">Day 26 (Pre-menstrual)</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-blue-700">Weather:</span>
                                <span class="text-sm font-medium text-blue-800">Pressure dropped 15mb</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Treatments & Relief -->
                <div class="mb-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Treatments & Relief</h3>
                    
                    <!-- Medications Taken -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-3">💊 What did you take?</label>
                        <div class="space-y-2" id="medicationsList">
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center">
                                    <input type="checkbox" id="med_sumatriptan" class="mr-3" onchange="toggleMedicationTaken('sumatriptan', '50mg')">
                                    <label for="med_sumatriptan" class="font-medium">Sumatriptan 50mg</label>
                                </div>
                                <input type="time" class="text-sm border border-gray-300 rounded px-2 py-1" disabled id="time_sumatriptan">
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center">
                                    <input type="checkbox" id="med_ibuprofen" class="mr-3" onchange="toggleMedicationTaken('ibuprofen', '400mg')">
                                    <label for="med_ibuprofen" class="font-medium">Ibuprofen 400mg</label>
                                </div>
                                <input type="time" class="text-sm border border-gray-300 rounded px-2 py-1" disabled id="time_ibuprofen">
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center">
                                    <input type="checkbox" id="med_acetaminophen" class="mr-3" onchange="toggleMedicationTaken('acetaminophen', '500mg')">
                                    <label for="med_acetaminophen" class="font-medium">Acetaminophen 500mg</label>
                                </div>
                                <input type="time" class="text-sm border border-gray-300 rounded px-2 py-1" disabled id="time_acetaminophen">
                            </div>
                        </div>
                    </div>

                    <!-- Non-Pharmacological Relief -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-3">🛌 What else did you do?</label>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="toggleReliefMeasure('dark_room')" class="relief-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">🌑 Dark, Quiet Room</button>
                            <button onclick="toggleReliefMeasure('cold_pack')" class="relief-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">🧊 Cold Pack</button>
                            <button onclick="toggleReliefMeasure('heat_pack')" class="relief-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">🔥 Heat Pack</button>
                            <button onclick="toggleReliefMeasure('hydration')" class="relief-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">💧 Drank Water/Electrolytes</button>
                            <button onclick="toggleReliefMeasure('caffeine')" class="relief-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">☕ Had Caffeine</button>
                            <button onclick="toggleReliefMeasure('meditation')" class="relief-btn bg-gray-100 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-200 transition-colors">🧘 Meditation/Breathing</button>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex space-x-3">
                    <button onclick="closeDetailedLog()" class="flex-1 bg-gray-200 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-300 transition-colors">Cancel</button>
                    <button onclick="saveDetailedLog()" class="flex-1 bg-indigo-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-indigo-700 transition-colors">Save Entry</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Analytics View -->
    <div id="analytics" class="view hidden max-w-4xl mx-auto p-4">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Analytics & Insights</h2>
        
        <!-- Migraine Calendar -->
        <div class="bg-white rounded-lg p-6 shadow-sm mb-8">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">📅 My Migraine Calendar</h3>
            <div class="grid grid-cols-7 gap-1 text-center text-sm">
                <!-- Calendar Header -->
                <div class="font-semibold text-gray-600 py-2">Sun</div>
                <div class="font-semibold text-gray-600 py-2">Mon</div>
                <div class="font-semibold text-gray-600 py-2">Tue</div>
                <div class="font-semibold text-gray-600 py-2">Wed</div>
                <div class="font-semibold text-gray-600 py-2">Thu</div>
                <div class="font-semibold text-gray-600 py-2">Fri</div>
                <div class="font-semibold text-gray-600 py-2">Sat</div>
                
                <!-- Calendar Days -->
                <div class="py-2 text-gray-400">30</div>
                <div class="py-2 text-gray-400">31</div>
                <div class="py-2 bg-red-100 text-red-800 rounded font-semibold">1</div>
                <div class="py-2">2</div>
                <div class="py-2">3</div>
                <div class="py-2 bg-yellow-100 text-yellow-800 rounded font-semibold">4</div>
                <div class="py-2">5</div>
                <div class="py-2">6</div>
                <div class="py-2">7</div>
                <div class="py-2 bg-red-100 text-red-800 rounded font-semibold">8</div>
                <div class="py-2">9</div>
                <div class="py-2">10</div>
                <div class="py-2">11</div>
                <div class="py-2">12</div>
                <div class="py-2">13</div>
                <div class="py-2">14</div>
                <div class="py-2 bg-yellow-100 text-yellow-800 rounded font-semibold">15</div>
                <div class="py-2">16</div>
                <div class="py-2">17</div>
                <div class="py-2">18</div>
                <div class="py-2">19</div>
                <div class="py-2 bg-red-100 text-red-800 rounded font-semibold">20</div>
                <div class="py-2">21</div>
                <div class="py-2">22</div>
                <div class="py-2">23</div>
                <div class="py-2">24</div>
                <div class="py-2">25</div>
                <div class="py-2">26</div>
                <div class="py-2 bg-yellow-100 text-yellow-800 rounded font-semibold">27</div>
                <div class="py-2">28</div>
                <div class="py-2">29</div>
                <div class="py-2">30</div>
            </div>
            <div class="flex items-center justify-center space-x-6 mt-4 text-sm">
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-red-100 rounded mr-2"></div>
                    <span>Severe (7-10)</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-yellow-100 rounded mr-2"></div>
                    <span>Moderate (4-6)</span>
                </div>
                <div class="flex items-center">
                    <div class="w-4 h-4 bg-green-100 rounded mr-2"></div>
                    <span>Mild (1-3)</span>
                </div>
            </div>
        </div>

        <!-- Trigger Analysis Report -->
        <div class="bg-white rounded-lg p-6 shadow-sm mb-8">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">🎯 Trigger Analysis Report</h3>
            <div class="space-y-4">
                <div class="p-4 bg-red-50 rounded-lg border-l-4 border-red-400">
                    <p class="text-red-800 font-medium">You had 12 migraines last month. On 9 of those days (75%), the barometric pressure dropped significantly.</p>
                </div>
                <div class="p-4 bg-orange-50 rounded-lg border-l-4 border-orange-400">
                    <p class="text-orange-800 font-medium">Stress was reported as a trigger for 80% of your severe (7+) migraines.</p>
                </div>
                <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-400">
                    <p class="text-blue-800 font-medium">Migraines are 3x more likely to occur the day after you've had less than 6 hours of sleep.</p>
                </div>
                <div class="p-4 bg-purple-50 rounded-lg border-l-4 border-purple-400">
                    <p class="text-purple-800 font-medium">85% of your migraines occur within 2 days of your menstrual cycle start.</p>
                </div>
            </div>
        </div>

        <!-- Pattern Analysis -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="bg-white rounded-lg p-6 shadow-sm">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">📈 Frequency Trends</h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">This week</span>
                        <span class="font-semibold">2 headaches</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Last week</span>
                        <span class="font-semibold">3 headaches</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Monthly average</span>
                        <span class="font-semibold">7.2 headaches</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Avg duration</span>
                        <span class="font-semibold">4.5 hours</span>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg p-6 shadow-sm">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">🔍 Top Triggers</h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Work Stress</span>
                        <div class="flex items-center">
                            <div class="w-20 bg-gray-200 rounded-full h-2 mr-2">
                                <div class="bg-red-500 h-2 rounded-full" style="width: 80%"></div>
                            </div>
                            <span class="text-sm font-semibold">80%</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Lack of Sleep</span>
                        <div class="flex items-center">
                            <div class="w-20 bg-gray-200 rounded-full h-2 mr-2">
                                <div class="bg-orange-500 h-2 rounded-full" style="width: 60%"></div>
                            </div>
                            <span class="text-sm font-semibold">60%</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Weather Change</span>
                        <div class="flex items-center">
                            <div class="w-20 bg-gray-200 rounded-full h-2 mr-2">
                                <div class="bg-yellow-500 h-2 rounded-full" style="width: 40%"></div>
                            </div>
                            <span class="text-sm font-semibold">40%</span>
                        </div>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Hormonal</span>
                        <div class="flex items-center">
                            <div class="w-20 bg-gray-200 rounded-full h-2 mr-2">
                                <div class="bg-pink-500 h-2 rounded-full" style="width: 35%"></div>
                            </div>
                            <span class="text-sm font-semibold">35%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Treatment Effectiveness Report -->
        <div class="bg-white rounded-lg p-6 shadow-sm mb-8">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">💊 Treatment Effectiveness Report</h3>
            
            <!-- Medication Effectiveness -->
            <div class="mb-6">
                <h4 class="font-medium text-gray-700 mb-3">Medications</h4>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="text-center p-4 bg-green-50 rounded-lg border border-green-200">
                        <div class="text-2xl font-bold text-green-600">85%</div>
                        <div class="text-sm font-medium text-gray-700">Sumatriptan 50mg</div>
                        <div class="text-xs text-gray-500 mt-1">Effective within 2 hours</div>
                        <div class="text-xs text-green-600 mt-1">★★★★★ Highly Effective</div>
                    </div>
                    <div class="text-center p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                        <div class="text-2xl font-bold text-yellow-600">65%</div>
                        <div class="text-sm font-medium text-gray-700">Ibuprofen 400mg</div>
                        <div class="text-xs text-gray-500 mt-1">Partial relief in 3-4 hours</div>
                        <div class="text-xs text-yellow-600 mt-1">★★★☆☆ Moderately Effective</div>
                    </div>
                    <div class="text-center p-4 bg-red-50 rounded-lg border border-red-200">
                        <div class="text-2xl font-bold text-red-600">30%</div>
                        <div class="text-sm font-medium text-gray-700">Acetaminophen 500mg</div>
                        <div class="text-xs text-gray-500 mt-1">Limited effectiveness</div>
                        <div class="text-xs text-red-600 mt-1">★★☆☆☆ Low Effectiveness</div>
                    </div>
                </div>
            </div>

            <!-- Non-Pharmacological Interventions -->
            <div>
                <h4 class="font-medium text-gray-700 mb-3">Non-Pharmacological Interventions</h4>
                <div class="space-y-3">
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <span class="text-gray-700">'Resting in a dark, quiet room' was logged as a relief measure in <strong>100%</strong> of your resolved migraines.</span>
                        <span class="text-green-600 font-semibold">★★★★★</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <span class="text-gray-700">Cold pack application provided relief in <strong>78%</strong> of cases when used.</span>
                        <span class="text-green-600 font-semibold">★★★★☆</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <span class="text-gray-700">Hydration/electrolytes helped in <strong>65%</strong> of mild to moderate migraines.</span>
                        <span class="text-yellow-600 font-semibold">★★★☆☆</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Exportable Doctor's Report -->
        <div class="bg-white rounded-lg p-6 shadow-sm">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">📋 Exportable Doctor's Report</h3>
            <p class="text-gray-600 mb-4">Generate a comprehensive, professional report for your healthcare provider that includes all your migraine data, patterns, and treatment responses.</p>
            
            <div class="bg-blue-50 rounded-lg p-4 mb-4">
                <h4 class="font-medium text-blue-800 mb-2">Report will include:</h4>
                <ul class="text-sm text-blue-700 space-y-1">
                    <li>• Migraine frequency and intensity patterns</li>
                    <li>• Detailed trigger analysis with correlations</li>
                    <li>• Medication effectiveness ratings</li>
                    <li>• Hormonal cycle correlations (if applicable)</li>
                    <li>• Sleep and lifestyle factor analysis</li>
                    <li>• Visual calendar showing migraine patterns</li>
                </ul>
            </div>
            
            <div class="flex space-x-3">
                <button onclick="generateDoctorReport()" class="bg-indigo-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-indigo-700 transition-colors flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    Generate PDF Report
                </button>
                <button onclick="exportData()" class="bg-gray-200 text-gray-700 py-3 px-6 rounded-lg font-medium hover:bg-gray-300 transition-colors flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a2 2 0 002-2v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                    </svg>
                    Export Raw Data
                </button>
                <button onclick="emailReport()" class="bg-green-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-green-700 transition-colors flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                    </svg>
                    Email to Doctor
                </button>
            </div>
        </div>
    </div>

    <!-- Settings View -->
    <div id="settings" class="view hidden max-w-4xl mx-auto p-4">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">Settings & Personalization</h2>
        
        <!-- My Medications -->
        <div class="bg-white rounded-lg p-6 shadow-sm mb-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">My Medications</h3>
            
            <div class="mb-6">
                <h4 class="font-medium text-gray-700 mb-3">Acute/Abortive Medications</h4>
                <div class="space-y-2 mb-3" id="acuteMedications">
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <span>Sumatriptan 50mg</span>
                        <button class="text-red-500 hover:text-red-700">Remove</button>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <span>Ibuprofen 400mg</span>
                        <button class="text-red-500 hover:text-red-700">Remove</button>
                    </div>
                </div>
                <button onclick="addMedication('acute')" class="text-indigo-600 hover:text-indigo-800 font-medium">+ Add Medication</button>
            </div>

            <div>
                <h4 class="font-medium text-gray-700 mb-3">Preventative Medications</h4>
                <div class="space-y-2 mb-3" id="preventativeMedications">
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <span>Amitriptyline 25mg (daily)</span>
                        <button class="text-red-500 hover:text-red-700">Remove</button>
                    </div>
                </div>
                <button onclick="addMedication('preventative')" class="text-indigo-600 hover:text-indigo-800 font-medium">+ Add Medication</button>
            </div>
        </div>

        <!-- My Common Triggers -->
        <div class="bg-white rounded-lg p-6 shadow-sm mb-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">My Common Triggers</h3>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                <label class="flex items-center">
                    <input type="checkbox" checked class="mr-2">
                    <span class="text-sm">Stress</span>
                </label>
                <label class="flex items-center">
                    <input type="checkbox" checked class="mr-2">
                    <span class="text-sm">Lack of Sleep</span>
                </label>
                <label class="flex items-center">
                    <input type="checkbox" class="mr-2">
                    <span class="text-sm">Bright Lights</span>
                </label>
                <label class="flex items-center">
                    <input type="checkbox" checked class="mr-2">
                    <span class="text-sm">Weather Changes</span>
                </label>
                <label class="flex items-center">
                    <input type="checkbox" class="mr-2">
                    <span class="text-sm">Certain Foods</span>
                </label>
                <label class="flex items-center">
                    <input type="checkbox" checked class="mr-2">
                    <span class="text-sm">Hormonal</span>
                </label>
            </div>
            <div class="mt-4">
                <input type="text" placeholder="Add custom trigger..." class="w-full p-3 border border-gray-300 rounded-lg">
            </div>
        </div>

        <!-- Hormonal Cycle Tracking -->
        <div class="bg-white rounded-lg p-6 shadow-sm">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Hormonal Cycle Tracking</h3>
            <div class="mb-4">
                <label class="flex items-center">
                    <input type="checkbox" checked class="mr-2">
                    <span>Track migraines in relation to menstrual cycle</span>
                </label>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">First day of last period</label>
                    <input type="date" class="w-full p-3 border border-gray-300 rounded-lg">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Average cycle length (days)</label>
                    <input type="number" value="28" min="21" max="35" class="w-full p-3 border border-gray-300 rounded-lg">
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentEntry = {};
        let selectedLocations = [];
        let selectedCharacters = [];
        let selectedTriggers = [];
        let selectedMedications = [];
        let selectedSymptoms = [];
        let selectedReliefMeasures = [];
        let medicationsTaken = [];
        let migraines = JSON.parse(localStorage.getItem('migraines') || '[]');

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            updateRecentEntries();
            
            // Pain slider
            const painSlider = document.getElementById('painSlider');
            const painValue = document.getElementById('painValue');
            
            painSlider.addEventListener('input', function() {
                painValue.textContent = this.value;
            });

            // Head diagram click handlers
            document.querySelectorAll('.pain-area').forEach(area => {
                area.addEventListener('click', function() {
                    const location = this.dataset.location;
                    toggleLocation(location);
                    this.classList.toggle('selected');
                });
            });
        });

        // View management
        function showView(viewName) {
            document.querySelectorAll('.view').forEach(view => {
                view.classList.add('hidden');
            });
            document.getElementById(viewName).classList.remove('hidden');
        }

        // Quick log functions
        function startQuickLog() {
            document.getElementById('quickLogModal').classList.remove('hidden');
            currentEntry = {
                timestamp: new Date().toISOString(),
                startTime: new Date(),
                painLevel: 5
            };
        }

        function closeQuickLog() {
            document.getElementById('quickLogModal').classList.add('hidden');
            resetCurrentEntry();
        }

        function setStartTime(option) {
            const now = new Date();
            let startTime;
            
            document.querySelectorAll('.quick-time-btn').forEach(btn => {
                btn.classList.remove('bg-indigo-100', 'text-indigo-700');
                btn.classList.add('bg-gray-100', 'text-gray-700');
            });
            
            event.target.classList.remove('bg-gray-100', 'text-gray-700');
            event.target.classList.add('bg-indigo-100', 'text-indigo-700');
            
            switch(option) {
                case 'now':
                    startTime = now;
                    break;
                case '5min':
                    startTime = new Date(now.getTime() - 5 * 60000);
                    break;
                case '15min':
                    startTime = new Date(now.getTime() - 15 * 60000);
                    break;
                case '30min':
                    startTime = new Date(now.getTime() - 30 * 60000);
                    break;
            }
            
            currentEntry.startTime = startTime;
            document.getElementById('customStartTime').value = startTime.toISOString().slice(0, 16);
        }

        function saveForLater() {
            currentEntry.painLevel = parseInt(document.getElementById('painSlider').value);
            currentEntry.status = 'incomplete';
            
            migraines.push(currentEntry);
            localStorage.setItem('migraines', JSON.stringify(migraines));
            
            closeQuickLog();
            updateRecentEntries();
            
            // Show success message
            alert('Quick entry saved! You can add more details later when you feel better.');
        }

        function continueDetailed() {
            currentEntry.painLevel = parseInt(document.getElementById('painSlider').value);
            document.getElementById('quickLogModal').classList.add('hidden');
            document.getElementById('detailedLogModal').classList.remove('hidden');
        }

        // Detailed log functions
        function closeDetailedLog() {
            document.getElementById('detailedLogModal').classList.add('hidden');
            resetCurrentEntry();
        }

        function toggleLocation(location) {
            const index = selectedLocations.indexOf(location);
            if (index > -1) {
                selectedLocations.splice(index, 1);
            } else {
                selectedLocations.push(location);
            }
            
            // Update button appearance
            const btn = document.querySelector(`[onclick="toggleLocation('${location}')"]`);
            if (btn) {
                if (selectedLocations.includes(location)) {
                    btn.classList.remove('bg-gray-100', 'text-gray-700');
                    btn.classList.add('bg-indigo-100', 'text-indigo-700');
                } else {
                    btn.classList.remove('bg-indigo-100', 'text-indigo-700');
                    btn.classList.add('bg-gray-100', 'text-gray-700');
                }
            }
        }

        function toggleCharacter(character) {
            const index = selectedCharacters.indexOf(character);
            if (index > -1) {
                selectedCharacters.splice(index, 1);
            } else {
                selectedCharacters.push(character);
            }
            
            // Update button appearance
            const btn = document.querySelector(`[onclick="toggleCharacter('${character}')"]`);
            if (btn) {
                if (selectedCharacters.includes(character)) {
                    btn.classList.remove('bg-gray-100', 'text-gray-700');
                    btn.classList.add('bg-indigo-100', 'text-indigo-700');
                } else {
                    btn.classList.remove('bg-indigo-100', 'text-indigo-700');
                    btn.classList.add('bg-gray-100', 'text-gray-700');
                }
            }
        }

        function toggleTrigger(trigger) {
            const index = selectedTriggers.indexOf(trigger);
            if (index > -1) {
                selectedTriggers.splice(index, 1);
            } else {
                selectedTriggers.push(trigger);
            }
            
            // Update button appearance
            const btn = document.querySelector(`[onclick="toggleTrigger('${trigger}')"]`);
            if (btn) {
                if (selectedTriggers.includes(trigger)) {
                    btn.classList.remove('bg-gray-100', 'text-gray-700');
                    btn.classList.add('bg-indigo-100', 'text-indigo-700');
                } else {
                    btn.classList.remove('bg-indigo-100', 'text-indigo-700');
                    btn.classList.add('bg-gray-100', 'text-gray-700');
                }
            }
        }

        function toggleMedication(medication) {
            const index = selectedMedications.indexOf(medication);
            if (index > -1) {
                selectedMedications.splice(index, 1);
            } else {
                selectedMedications.push(medication);
            }
            
            // Update button appearance
            const btn = document.querySelector(`[onclick="toggleMedication('${medication}')"]`);
            if (btn) {
                if (selectedMedications.includes(medication)) {
                    btn.classList.remove('bg-gray-100', 'text-gray-700');
                    btn.classList.add('bg-indigo-100', 'text-indigo-700');
                } else {
                    btn.classList.remove('bg-indigo-100', 'text-indigo-700');
                    btn.classList.add('bg-gray-100', 'text-gray-700');
                }
            }
        }

        function toggleAuraDetails() {
            const auraDetails = document.getElementById('auraDetails');
            const hasAura = document.querySelector('input[name="aura"]:checked').value === 'yes';
            
            if (hasAura) {
                auraDetails.classList.remove('hidden');
            } else {
                auraDetails.classList.add('hidden');
            }
        }

        function saveDetailedLog() {
            // Collect aura information
            const hasAura = document.querySelector('input[name="aura"]:checked').value === 'yes';
            let auraTypes = [];
            if (hasAura) {
                auraTypes = Array.from(document.querySelectorAll('#auraDetails input[type="checkbox"]:checked'))
                    .map(cb => cb.value);
            }
            
            // Complete the entry
            currentEntry.locations = [...selectedLocations];
            currentEntry.characters = [...selectedCharacters];
            currentEntry.triggers = [...selectedTriggers];
            currentEntry.medications = [...selectedMedications];
            currentEntry.symptoms = [...selectedSymptoms];
            currentEntry.reliefMeasures = [...selectedReliefMeasures];
            currentEntry.medicationsTaken = [...medicationsTaken];
            currentEntry.aura = hasAura;
            currentEntry.auraTypes = auraTypes;
            currentEntry.status = 'complete';
            currentEntry.completedAt = new Date().toISOString();
            
            migraines.push(currentEntry);
            localStorage.setItem('migraines', JSON.stringify(migraines));
            
            closeDetailedLog();
            updateRecentEntries();
            
            // Show success message
            alert('Detailed entry saved! Your migraine has been logged with comprehensive information.');
        }

        function toggleSymptom(symptom) {
            const index = selectedSymptoms.indexOf(symptom);
            if (index > -1) {
                selectedSymptoms.splice(index, 1);
            } else {
                selectedSymptoms.push(symptom);
            }
            
            // Update button appearance
            const btn = document.querySelector(`[onclick="toggleSymptom('${symptom}')"]`);
            if (btn) {
                if (selectedSymptoms.includes(symptom)) {
                    btn.classList.remove('bg-gray-100', 'text-gray-700');
                    btn.classList.add('bg-indigo-100', 'text-indigo-700');
                } else {
                    btn.classList.remove('bg-indigo-100', 'text-indigo-700');
                    btn.classList.add('bg-gray-100', 'text-gray-700');
                }
            }
        }

        function toggleReliefMeasure(measure) {
            const index = selectedReliefMeasures.indexOf(measure);
            if (index > -1) {
                selectedReliefMeasures.splice(index, 1);
            } else {
                selectedReliefMeasures.push(measure);
            }
            
            // Update button appearance
            const btn = document.querySelector(`[onclick="toggleReliefMeasure('${measure}')"]`);
            if (btn) {
                if (selectedReliefMeasures.includes(measure)) {
                    btn.classList.remove('bg-gray-100', 'text-gray-700');
                    btn.classList.add('bg-indigo-100', 'text-indigo-700');
                } else {
                    btn.classList.remove('bg-indigo-100', 'text-indigo-700');
                    btn.classList.add('bg-gray-100', 'text-gray-700');
                }
            }
        }

        function toggleMedicationTaken(medication, dosage) {
            const checkbox = document.getElementById(`med_${medication}`);
            const timeInput = document.getElementById(`time_${medication}`);
            
            if (checkbox.checked) {
                timeInput.disabled = false;
                timeInput.value = new Date().toTimeString().slice(0, 5);
                
                const medEntry = {
                    name: medication,
                    dosage: dosage,
                    timestamp: new Date().toISOString()
                };
                
                const existingIndex = medicationsTaken.findIndex(med => med.name === medication);
                if (existingIndex > -1) {
                    medicationsTaken[existingIndex] = medEntry;
                } else {
                    medicationsTaken.push(medEntry);
                }
            } else {
                timeInput.disabled = true;
                timeInput.value = '';
                medicationsTaken = medicationsTaken.filter(med => med.name !== medication);
            }
        }

        function toggleTriggerCategory(category) {
            const categoryDiv = document.getElementById(`${category}Triggers`);
            const arrow = document.getElementById(`${category}Arrow`);
            
            if (categoryDiv.classList.contains('hidden')) {
                categoryDiv.classList.remove('hidden');
                arrow.style.transform = 'rotate(180deg)';
            } else {
                categoryDiv.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        function resetCurrentEntry() {
            currentEntry = {};
            selectedLocations = [];
            selectedCharacters = [];
            selectedTriggers = [];
            selectedMedications = [];
            selectedSymptoms = [];
            selectedReliefMeasures = [];
            medicationsTaken = [];
            
            // Reset UI
            document.querySelectorAll('.location-btn, .character-btn, .trigger-btn, .medication-btn, .symptom-btn, .relief-btn').forEach(btn => {
                btn.classList.remove('bg-indigo-100', 'text-indigo-700');
                btn.classList.add('bg-gray-100', 'text-gray-700');
            });
            
            document.querySelectorAll('.pain-area').forEach(area => {
                area.classList.remove('selected');
            });

            // Reset medication checkboxes
            document.querySelectorAll('input[type="checkbox"][id^="med_"]').forEach(checkbox => {
                checkbox.checked = false;
                const timeInput = document.getElementById(checkbox.id.replace('med_', 'time_'));
                if (timeInput) {
                    timeInput.disabled = true;
                    timeInput.value = '';
                }
            });
        }

        function updateRecentEntries() {
            const container = document.getElementById('recentEntries');
            const recent = migraines.slice(-5).reverse();
            
            if (recent.length === 0) {
                container.innerHTML = '<div class="p-4 text-center text-gray-500">No entries yet. Log your first headache above!</div>';
                return;
            }
            
            container.innerHTML = recent.map(entry => {
                const date = new Date(entry.startTime).toLocaleDateString();
                const time = new Date(entry.startTime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const statusBadge = entry.status === 'incomplete' 
                    ? '<span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full">Incomplete</span>'
                    : '<span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Complete</span>';
                
                return `
                    <div class="p-4 hover:bg-gray-50 transition-colors">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="flex items-center space-x-2">
                                    <span class="font-medium">Pain Level ${entry.painLevel}/10</span>
                                    ${statusBadge}
                                </div>
                                <div class="text-sm text-gray-600">${date} at ${time}</div>
                                ${entry.locations ? `<div class="text-sm text-gray-500 mt-1">Location: ${entry.locations.join(', ')}</div>` : ''}
                            </div>
                            <div class="flex space-x-2">
                                ${entry.status === 'incomplete' ? '<button class="text-indigo-600 hover:text-indigo-800 text-sm">Complete</button>' : ''}
                                <button class="text-gray-400 hover:text-gray-600 text-sm">Edit</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Analytics functions
        function generateDoctorReport() {
            // Create a comprehensive report
            const reportData = {
                patientSummary: {
                    totalMigraines: migraines.length,
                    averageIntensity: migraines.reduce((sum, m) => sum + m.painLevel, 0) / migraines.length,
                    mostCommonTriggers: getMostCommonTriggers(),
                    medicationEffectiveness: getMedicationEffectiveness()
                },
                migraines: migraines,
                generatedAt: new Date().toISOString()
            };
            
            alert('Comprehensive PDF report generated! This professional report includes all your migraine patterns, trigger analysis, and treatment effectiveness data for your healthcare provider.');
            console.log('Doctor Report Data:', reportData);
        }

        function getMostCommonTriggers() {
            const triggerCounts = {};
            migraines.forEach(migraine => {
                if (migraine.triggers) {
                    migraine.triggers.forEach(trigger => {
                        triggerCounts[trigger] = (triggerCounts[trigger] || 0) + 1;
                    });
                }
            });
            
            return Object.entries(triggerCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5)
                .map(([trigger, count]) => ({
                    trigger,
                    count,
                    percentage: Math.round((count / migraines.length) * 100)
                }));
        }

        function getMedicationEffectiveness() {
            const medCounts = {};
            migraines.forEach(migraine => {
                if (migraine.medicationsTaken) {
                    migraine.medicationsTaken.forEach(med => {
                        if (!medCounts[med.name]) {
                            medCounts[med.name] = { total: 0, effective: 0 };
                        }
                        medCounts[med.name].total++;
                        // Simulate effectiveness based on pain reduction
                        if (migraine.painLevel <= 4) {
                            medCounts[med.name].effective++;
                        }
                    });
                }
            });
            
            return Object.entries(medCounts).map(([name, data]) => ({
                name,
                effectiveness: Math.round((data.effective / data.total) * 100)
            }));
        }

        function exportData() {
            const dataStr = JSON.stringify(migraines, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'migraine-data.json';
            link.click();
        }

        function emailReport() {
            alert('Email functionality would integrate with your email client to send the report directly to your healthcare provider.');
        }

        // Settings functions
        function addMedication(type) {
            const name = prompt(`Enter ${type} medication name and dosage (e.g., "Sumatriptan 50mg"):`);
            if (name) {
                const container = document.getElementById(type === 'acute' ? 'acuteMedications' : 'preventativeMedications');
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                div.innerHTML = `
                    <span>${name}</span>
                    <button class="text-red-500 hover:text-red-700" onclick="this.parentElement.remove()">Remove</button>
                `;
                container.appendChild(div);
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96963185d07c849b',t:'MTc1NDIyODA3Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
